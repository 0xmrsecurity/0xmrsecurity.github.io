---
title: "IAM"
date: 2026-01-25 00:00:00 +0530
tags: [iam, iam enumeration]
author: 0xmr
image: /assets/img/posts/iam.webp
---



# ‚õàÔ∏è IAM
IAM Stands for Identity and Access Management (IAM).It is a framework used in cloud computing to control and Manage.
- Who can access: This includes users, applications, and services that require entry to the system.
- What can be accessed: This pertains to resources, data, and applications that are available to authorized entities.
- Under what conditions: This involves defining permissions, policies, and authentication methods to regulate access.

>  üí° Key Takeaway
- Managed ‚Üí Visible, Shared, Auditable = SAFE ‚úÖ
- Inline  ‚Üí Hidden, Personal, Easy Miss = RISKY ‚ö†Ô∏è

> As a Pentester: `Always check INLINE first!`
> They hide the most dangerous permissions! üéØ

`IAM ensures secure and controlled access to cloud resources.`
```bash 
# Put all details like Access key, Secret keys, Region and Formate.
aws configure
or
aws configure --profile <Profile Name>

# Your AWS "whoami" ‚Äî always run this first
aws sts get-caller-identity 
 
# Full snapshot of ALL users, groups, roles, policies
aws iam get-account-authorization-details
```

## Users
Users represent people or applications. They have long-term credentials like usernames, passwords, and access keys.
- Types:
     - End Users: Typical users who access applications and services.
     - Service Accounts: Non-human accounts used by applications or services to interact with other services.

> Important Checks..

```bash
For Users:
  aws iam list-user-policies            üî∂  ‚Üê Inline
  aws iam list-attached-user-policies   üî∑  ‚Üê Managed
```

```bash
# List all users
aws iam list-users

# Get user metadata (includes permission boundaries)
aws iam get-user --user-name <username>

# Check if user can login to AWS Console
aws iam get-login-profile --user-name <username>

# List user's access keys
aws iam list-access-keys --user-name <username>

# See which groups the user belongs to
aws iam list-groups-for-user --user-name <username>

# üî∂ INLINE policies on a user
aws iam list-user-policies --user-name <username>
aws iam get-user-policy --user-name <username> --policy-name <policyname>

# üî∑ MANAGED policies on a user
aws iam list-attached-user-policies --user-name <username>
```     
     
##  Groups
Groups are just a way to manage permissions for multiple users at once.    
- Example
If I have five backend engineers at Hackers University who all need the same access, it‚Äôs a lot easier to stick them in a group and apply one policy to the group rather than duplicating it across five users.

> Important Checks...

```bash
For Groups:
  aws iam list-group-policies           üî∂ ‚Üê Inline
  aws iam list-attached-group-policies  üî∑ ‚Üê Managed
```

```bash
# List all groups
aws iam list-groups

# check in which Group User Belong To
aws iam list-groups-for-user --user-name <User Name> --profile <Profile Name>

# List all Users in Groups
aws iam get-group --group-name <Group Name> --profile <Profile Name>

# üî∂ INLINE policies on a group
aws iam list-group-policies --group-name <groupname>
aws iam get-group-policy --group-name <groupname> --policy-name <policyname>

# üî∑ MANAGED policies on a group
aws iam list-attached-group-policies --group-name <groupname>

# Detail about Specific Group Policies
aws iam get-group-policy --group-name <Group Name> --policy-name <Policy Name> --profile <Profile Name>
```

##  Policies
-  Rules that define permissions for users and groups regarding access to resources.
-  Policies define what a user, group, or role can and can‚Äôt do. They‚Äôre written in JSON and attached to IAM entities. 
There are two kinds:-
1. Managed Policies ‚Äì Reusable across users and groups. These are easier to manage and scale.
2. Inline Policies ‚Äì Attached directly to one user or group. These are harder to track and often the source of privilege escalation bugs in real-world environments.
`In pentests, most of the misconfigurations, come down to sloppy or forgotten policies‚Äîespecially inline ones.`

```bash
# list Attached Policies
aws iam list-user-policies --user-name <User Name>--profile <Profile Name>

# Get More Detail about Specific Policies
aws iam get-user-policy --user-name <User Name> policy-name <Policy Name> --profile <Profile Name>

# List all username and roles via cloudfox
cloudfox aws inventory
cloudfox aws principals --profile <profile>
# Get Attached User policies
aws iam list-attached-user-policies --user-name <username>

# Get Policies Version :- get-policy-version
aws iam get-policy-version  --policy-arn <policy_arn>  --version-id v1

# List Role Policies
cloudfox aws principles --profile <profile>
aws iam list-role-policies --role-name <Role_Name>

-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


# List only customer-managed policies
aws iam list-policies --scope Local

# List only currently attached policies
aws iam list-policies --only-attached

# Get policy metadata (includes DefaultVersionId)
aws iam get-policy --policy-arn <arn>

# List all versions of a policy (v1, v2, v3...)
aws iam list-policy-versions --policy-arn <arn>

# Get full content of a specific policy version
aws iam get-policy-version --policy-arn <arn> --version-id <v1>

# See all users/groups/roles using this policy
aws iam list-entities-for-policy --policy-arn <arn>
```

## Roles
Roles are like users but without long-term credentials. You assume a role temporarily, and AWS gives you credentials that expire after a set time. 
- Example:-
    - if I‚Äôm a security analyst investigating an incident, I might assume a role that gives me access to logs for a few hours and then loses access when I‚Äôm done. Roles help enforce the principle of least privilege.

> Important Check..

```bash
For Roles:
  aws iam list-role-policies           üî∂ ‚Üê Inline
  aws iam list-attached-role-policies  üî∑ ‚Üê Managed
```


```bash
# List all roles
aws iam list-roles

# Query to Specific Role Names
aws iam list-roles --query "Roles[?RoleName=='Role Name']" --profile <Profile Name>

# Get role details + trust policy (who can assume it)
aws iam get-role --role-name <rolename>

# üî∂ INLINE policies on a role
aws iam list-role-policies --role-name <rolename>
aws iam get-role-policy --role-name <rolename> --policy-name <policyname>

# üî∑ MANAGED policies on a role
aws iam list-attached-role-policies --role-name <rolename>

# Get Detail About Policies
aws iam get-role-policy  --role-name <Role Name> --policy-name <Policy Name> --profile <Profile Name>
```

## Final check list (what to watch for) 
- Users with excessive permissions.
- Roles that can be assumed.
- Policies that use wildcards (e.g., "Action": "*" or "Resource": "*").
- Services or Lambda functions with elevated permissions that you can potentially abuse.


## Ai Automation Script 
iam-enum.py, Ai Generated python based iam enumeration checks for iam permissions.
```bash
python3 iam-enum.py --profile default

<snip>...
```

-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

<!--
# IAM Enumeration CLI commands
## Retrieves general account information about including IAM users, groups, 
## roles, and policies, and their relationships to one another. 
## These are meant to be non-destructive enumeration commands. They only retrieve information. They do not modify resources.
## Official AWS IAM CLI documentation: https://awscli.amazonaws.com/v2/documentation/api/latest/reference/iam/index.html

# The "whoami" in AWS
aws sts get-caller-identity # Returns details about the IAM user or role whose credentials are used to call the operation. While not an IAM command (it's an STS command), this is often the first command that gets used for IAM enumeration which is why it's included here. 
# No policy can deny issuing this command since it gives the same information when access is denied. More on that here: https://awscli.amazonaws.com/v2/documentation/api/latest/reference/sts/get-caller-identity.html

# General IAM account information
aws iam get-account-authorization-details # Gives a snapshot of the configuration of IAM permissions (users, groups, roles, and  policies) and their relationships in your account.

# User enumeration
aws iam list-users
aws iam list-service-specific-credentials # Get service-specific credentials associated with the IAM user
aws iam get-user --user-name <username> # Get metadata of user. Includes permissions boundaries!
aws iam list-access-keys [--user-name <value>] # List existing access keys for a specific user (your current user being the default if no value is specified)
aws iam list-user-policies --user-name <username> # Get inline policies for a user
aws iam get-user-policy --user-name <username> --policy-name <policyname> # Get details about an inline policy
aws iam list-attached-user-policies --user-name <username> # Get attached (managed) policies (instead of inline policies). These can be either AWS-managed or Customer-managed policies
aws iam get-login-profile --user-name # Checks to see if the user has a login profile (password to log into the AWS Console). Returns the UserName and CreatedDate, which reflects the creation date of the password

# Groups Enumeration 
aws iam list-groups # Get groups in account
aws iam list-groups-for-user --user-name <username> # Get groups related to a user
aws iam get-group --group-name <name> # Get a group's details
aws iam list-group-policies --group-name <username> # Get inline policies of a group
aws iam get-group-policy --group-name <username> --policy-name <policyname> # Get inline policy details
aws iam list-attached-group-policies --group-name <name> # Get attached (managed) policies for a group (instead of inline policies). These can be either AWS-managed or Customer-managed policies

# Enumerate roles
aws iam list-roles # Get roles in the AWS account
aws iam get-role --role-name <role-name> # Get details about a specific role
aws iam list-role-policies --role-name <name> # Get inline policies of a role
aws iam get-role-policy --role-name <name> --policy-name <name> # Get inline policy details
aws iam list-attached-role-policies --role-name <role-name> # Get attached (managed) policies for a role (instead of inline policies). These can be either AWS-managed or Customer-managed policies

# Enumerate policies
aws iam list-policies [--only-attached] [--scope Local] # List policies
# [--only-attached] is optional and will list policies only if they're attached to an IAM user/group/role
# [--scope local] is optional and will only list policies that are Customer-managed, not AWS-managed. --scope AWS would be the opposite
aws iam list-policies-granting-service-access --arn <identity> --service-namespaces <svc> # Get list of policies that a user/group/role can use to access a specific service
# Example: aws iam list-policies-granting-service-access --arn arn:aws:iam::123456789012:user/UserName --service-namespaces eks
aws iam get-policy --policy-arn <policy_arn> # Get details for a specific policy
aws iam list-policy-versions --policy-arn <arn> # Returns information about policy versions for a specific managed policy, including which one is the current default version
aws iam get-policy-version --policy-arn <arn:aws:iam::123456789012:policy/example-policy> --version-id <v1 or v2 or ...> # Get details for a specific policy version since policies can have multiple versions
aws iam list-entities-for-policy --policy-arn <value> # Lists all the IAM users/groups/roles that the managed policy is attached to

# MFA
aws iam list-mfa-devices [--user-name <username>]  # Get list of all MFA devices for a specific user. If no user is provided, AWS auto determines the user based on the access key ID
aws iam list-virtual-mfa-devices [--assignment-status <value>] # Get list of all MFA devices in the AWS account
# Can use optional --assignment-status to filter by Assigned, Unassigned, or Any (the default)
-->
